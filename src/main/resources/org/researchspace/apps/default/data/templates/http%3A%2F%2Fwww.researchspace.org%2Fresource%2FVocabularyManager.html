[[!--
uses client-side templates:
[[> rsp:HierarchyManagerTemplate]]
--]]

<ol class="page-breadcrumb">
  <li>
    <mp-link title="Home" url="/">Home</mp-link>
  </li>
  <li class="active">
    Vocabulary Manager 
  </li>
</ol>

<div class="page">
[[#>rsp:ClipboardSidebar]]
[[#>rsp:DetailsSidebar]]

[[#> rsp:HierarchyManagerTemplate title="Vocabulary" type="Scheme" scheme=true]]
    [[#*inline "addNewStructureForm"]]
             <semantic-search id="scheme-iri-selector">
                <semantic-search-form-query 
                                            query-template='{
                                              "queryString": "SELECT $schemeLabel ?entityTypeURI { BIND($label as ?schemeLabel). BIND(?entitytype as ?entityTypeURI )}",
                                              "arguments": {
                                                "label": {"type": "xsd:string"},
                                                "entitytype":{"type":"xsd:anyURI"}
                                              }
                                            }'

                                            fields='[{"id": "label", "label": "scheme label", "xsdDatatype": "http://www.w3.org/2001/XMLSchema#string"},
                                                     {
                                                "id": "entitytype",
                                                "label": "Entity Type",
                                                "xsdDatatype": "xsd:anyURI",
                                                "valueSetPattern": "SELECT $value $label WHERE { VALUES ($value $label)
                                                { (<http://www.w3.org/2004/02/skos/core#Concept> \"Concept\")
                                                  (<http://www.cidoc-crm.org/cidoc-crm/E21_Person> \"Person\")
                                                  (<http://www.cidoc-crm.org/cidoc-crm/E4_Period> \"Period\")
                                                  (<http://www.cidoc-crm.org/cidoc-crm/E53_Place> \"Place\") 
                                                  }}"
                                                }
                                            ]'>
                  <semantic-form-text-input for="label" placeholder="enter new scheme label"></semantic-form-text-input>            
                   <semantic-form-checklist-input for='entitytype' type="radio" class='class name' class-item-name='item class name'>
                    </semantic-form-checklist-input>
                  <button type='button' name='submit' className='btn btn-primary' style="margin-top: 0;">Create Scheme</button>
                
                </semantic-search-form-query>
                <semantic-search-result-holder>
                  <semantic-search-result>
                    <semantic-query id='new-scheme-form' query='
                                      SELECT ?schemeLabel ?scheme ?entityType ?exists WHERE {
                                        BIND(IRI(CONCAT(STR(Default:), "vocab/", ENCODE_FOR_URI(REPLACE(LCASE(?schemeLabel), "\\s", "_")))) AS ?scheme) .
                                        BIND(?entityTypeURI as ?entityType)
                                        OPTIONAL {
                                          ?scheme a skos:ConceptScheme .
                                          BIND(true as ?exists) .
                                        }
                                        OPTIONAL {
                                          ?scheme a crm:E32_Authority_Document .
                                          BIND(true as ?exists) .
                                        }
                                      }
                                    '
                                    template='{{> template}}'
                                    >
                      <template id='template'>
                        <div class="confirm-message">
                          {{#if bindings.0.exists}}
                            <div>Scheme with label &nbsp;<b>{{bindings.0.schemeLabel.value}}{{bindings.0.entityType.value}} </b>&nbsp; and IRI &nbsp;<b>{{bindings.0.scheme.value}}</b> <br> already exists!</div> 
                          {{else}}
                            <div>Are you sure you want to create new scheme with IRI: <b>{{bindings.0.scheme.value}} {{bindings.0.entityType.value}}</b> ?</div>                       
                            <semantic-form id='new-scheme-form' 
                                          persistence='{"type": "sparql", "targetGraphIri": "{{bindings.0.scheme.value}}"}'
                                          new-subject-template='{{bindings.0.scheme.value}}'
                                          post-action="redirect"
                                          fields='[[
                                            fieldDefinitions
                                              prefLabel="http://www.w3.org/2004/02/skos/core#prefLabel"
                                              rdfsLabel="http://www.w3.org/2000/01/rdf-schema#label"
                                              classtype="http://www.w3.org/1999/02/22-rdf-syntax-ns#type"
                                              refersto="http://www.cidoc-crm.org/cidoc-crm/P67_refers_to"
                                              
                                          ]]'
                            >
                              <semantic-form-hidden-input for="refersto" default-value='{{bindings.0.entityType.value}}'></semantic-form-hidden-input>
                              {{#ifCond bindings.0.entityType.value "===" "http://www.w3.org/2004/02/skos/core#Concept"}}
                                <semantic-form-hidden-input for="prefLabel" default-value='{{bindings.0.schemeLabel.value}}'></semantic-form-hidden-input>
                                <semantic-form-hidden-input for="classtype" default-values='["http://www.w3.org/2004/02/skos/core#ConceptScheme","http://www.cidoc-crm.org/cidoc-crm/E73_Information_Object"]'></semantic-form-hidden-input>
                              {{/ifCond}}
                              
                              {{#ifCond bindings.0.entityType.value "!==" "http://www.w3.org/2004/02/skos/core#Concept"}}
                                <semantic-form-hidden-input for="classtype" default-values='["http://www.cidoc-crm.org/cidoc-crm/E32_Authority_Document","http://www.cidoc-crm.org/cidoc-crm/E73_Information_Object"]'></semantic-form-hidden-input>
                                <semantic-form-hidden-input for="rdfsLabel" default-value='{{bindings.0.schemeLabel.value}}'></semantic-form-hidden-input>                       
                              {{/ifCond}}
                              <semantic-form-errors></semantic-form-errors>
                              <!-- save and reset button for form -->
                              <button name="submit" class="btn btn-success" style="margin-right: 5px;">Confirm</button>
                              <button name="cancel" class="btn btn-danger">Cancel</button>
                            </semantic-form>
                          {{/if}}
                        </div>
                        
                      </template>
                    </semantic-query>
                  </semantic-search-result>
                </semantic-search-result-holder>
              </semantic-search>
          [[/inline]]
    [[#*inline "customUploadNewStructureMessage"]]
       <p>Please drag&amp;drop your *.trig or *.nq RDF file(s) with SKOS vocabularies here or Authority Document with heterogeneous data.</p>
       <p>For a <i>skos:ConceptScheme</i> or <i>crm:E32_Authority_Document</i> all corresponding entities should be defined in one named graph that equals to the scheme IRI!</p>             
    [[/inline]]
    [[#*inline "exceptionsStructureList"]]
      <semantic-query 
                      query='
                        SELECT ?scheme ?schemeGraph WHERE { 
                          {
                            GRAPH ?schemeGraph {
                              ?scheme a skos:ConceptScheme .
                            }
                          }
                          UNION {
                            GRAPH ?schemeGraph {
                              ?scheme a crm:E32_Authority_Document .
                            }
                          }
                          FILTER(?schemeGraph != ?scheme) .
                        }
                        ' 
                      template='{{> template}}'
                      >
        <template id='template'>
          <div class='warning-area'>
            <div class='warning-message'>
              <div>Warning! &nbsp; There are vocabularies in the system that can't be edited with Vocabulary Manager!</div> 
              <div><i>skos:ConceptScheme</i> and all corresponding <i>skos:Concept</i> should be defined in one named graph that equals to the scheme IRI</div>
            </div>
            <ul class="scheme-list">
              {{#each bindings}}<li><semantic-link iri='{{scheme.value}}'></semantic-link> - IRI: {{scheme.value}} , in the graph: {{schemeGraph.value}}</li>{{/each}}
            </ul>
          </div>
        </template>
      </semantic-query>
    [[/inline]]

[[/rsp:HierarchyManagerTemplate]]

[[/rsp:DetailsSidebar]]
[[/rsp:ClipboardSidebar]]

</div>
